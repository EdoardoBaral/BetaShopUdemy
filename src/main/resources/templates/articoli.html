<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<div th:insert="~{fragments/head.html :: head}"></div>
	<body>
		<div th:insert="~{fragments/navbar.html :: navbar}"></div>
		<section class="content-main">
			<div class="content-header">
				<h2 class="content-title">Lista Prodotti</h2>
				<div>
					<a href="/articoli/grid" class="btn btn-success">
						<i class="material-icons md-grid_on"></i>
						Grid View
					</a>
					<a th:href="@{/articoli/aggiungi}" class="btn btn-primary newart">
						<i class="material-icons md-plus"></i>
						Nuovo
					</a>
				</div>
			</div>
			<div class="card mb-4">
				<!-- Inizio Header -->
				<header class="card-header">
					<div class="row gx-3">
						<div class="col-lg-4 col-md-6 me-auto">
							<form class="form-inline my-2 my-lg-0"
							      id="search"
							      role="search"
							      method="GET"
							      th:action="@{/articoli/search}">
								<input type="text"
								       onclick="this.select();"
								       name="filtro"
								       th:value="${filtro}"
								       placeholder="Cerca..."
								       class="form-control">
							</form>
						</div>
						<div class="col-lg-2 col-6 col-md-3">
							<select class="form-select">
								<option>Status</option>
								<option>Attivo</option>
								<option>Eliminato</option>
								<option>Tutti</option>
							</select>
						</div>
						<div class="col-lg-2 col-6 col-md-3">
							<select class="form-select">
								<option>Categorie</option>
								<option>Alimentari</option>
								<option>Chimico</option>
								<option>Freschi</option>
							</select>
						</div>
						<div class="col-lg-2 col-6 col-md-3">
							<form>
								<select id="righe" class="form-select" onchange="refreshPage()">
									<option>--Righe--</option>
									<option value="10">Mostra 10</option>
									<option value="20">Mostra 20</option>
									<option value="30">Mostra 30</option>
								</select>
							</form>
						</div>
					</div>
				</header>
				<!-- Fine Header -->

				<!-- Inizio Body -->
				<div class="card-body">
					<div class="table-responsive">
						<table class="table table-hover">
							<thead>
								<tr>
									<th scope="col">Codice</th>
									<th scope="col">Descrizione</th>
									<th scope="col">Reparto</th>
									<th scope="col">Um</th>
									<th scope="col">Pezzi</th>
									<th scope="col">Peso</th>
									<th scope="col">Prezzo</th>
									<th scope="col">Tipo</th>
									<th scope="col">Data</th>
									<th scope="col">Status</th>
									<th scope="col" class="text-end">Azione</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="article : ${articoli}">
									<td class="tbl-string" th:text="${article.codart}"></td>
									<td class="tbl-string" th:text="${article.descrizione}"></td>
									<td class="tbl-string" th:text="${article.famAssort?.descrizione ?: 'N/A'}"></td>
									<td class="tbl-string" th:text="${article.um}"></td>
									<td class="tbl-string" th:text="${article.pzcart}"></td>
									<td class="tbl-string" th:text="${article.peso}"></td>
									<td class="tbl-string" th:text="${#numbers.formatDecimal(article.prezzo, 1, 'COMMA', 2, 'POINT')} + ' â‚¬'"></td>

									<td class="tbl-string infoBadge">
										<span class="badge rounded-pill text-bg-primary">
											Normale
										</span>
									</td>

									<td class="tbl-string" th:text="${#dates.format(article.data, 'dd/MM/yyyy')}"></td>

									<td class="tbl-string infoBadge">
										<span th:switch="${article.status}">
											<span th:case="'1'" class="badge rounded-pill text-bg-primary">Attivo</span>
											<span th:case="'2'" class="badge rounded-pill text-bg-warning">Sospeso</span>
											<span th:case="'3'" class="badge rounded-pill text-bg-danger">Eliminato</span>
										</span>
									</td>

									<td class="text-end">
										<!-- Link per l'eliminazione -->
										<a th:href="@{/articoli/elimina/{codart}(codart=${article.codart})}"
										   class="btn btn-light text-danger">
											Elimina
										</a>

										<!-- Menu a discesa (DropDown Menu) -->
										<div class="dropdown">
											<a href="#"
											   data-bs-toggle="dropdown"
											   class="btn btn-light">
												<i class="material-icons md-more_horiz"></i>
											</a>
											<ul class="dropdown-menu">
												<li><a class="dropdown-item" href="#">Dettaglio</a></li>
												<li><a class="dropdown-item" href="#">Info</a></li>
												<li>
													<a class="dropdown-item"
													   th:href="@{/articoli/modifica/{codart}(codart=${article.codart})}">
														Modifica
													</a>
												</li>
											</ul>
										</div>
									</td>
								</tr>
							</tbody>
						</table>

						<div th:if="${notFound}" class="alert alert-danger" role="alert">
							Articolo/i NON presente/i in anagrafica!!!
						</div>

						<!-- Inizio Blocco Paginazione -->
						<div>
							<nav class="float-end mt-3" aria-label="Page navigation">
								<ul class="pagination">

									<!-- Tasto Previous -->
									<li th:classappend="${PageNum le 1} ? 'page-item disabled' : 'page-item'">
										<a class="page-link"
										   th:href="@{'/articoli/cerca/parametri;paging=' + ${PageNum} + ',-1?filtro=' + ${filtro} + '&selected=' + ${RecPage}}"
										   aria-label="Previous">
											<span aria-hidden="true">&laquo;</span>
											<span class="sr-only">Precedente</span>
										</a>
									</li>

									<li th:each="pagina : ${Pages}"
									    th:class="${pagina.IsSelected} ? 'page-item active' : 'page-item'">
										<a class="page-link"
										   th:href="@{'/articoli/cerca/parametri;paging=' + ${pagina.PageNum} + ',0?filtro=' + ${filtro} + '&selected=' + ${RecPage}}"
										   th:text="${pagina.PageNum}"></a>
									</li>

									<!-- Tasto Next -->
									<li class="page-item">
										<a class="page-link"
										   th:href="@{'/articoli/cerca/parametri;paging=' + ${PageNum} + ',1?filtro=' + ${filtro} + '&selected=' + ${RecPage}}"
										   aria-label="Next">
											<span aria-hidden="true">&raquo;</span>
											<span class="sr-only">Successivo</span>
										</a>
									</li>

								</ul>
							</nav>
						</div>
						<!-- Fine Blocco Paginazione -->
					</div>
				</div>
			</div>
			<!-- Fine Body -->
		</section>

		<script th:inline="javascript">
			/*<![CDATA[*/
			function refreshPage() {
				var selectedValue = document.getElementById("righe").value;
				var filtroValue = /*[[${filtro}]]*/ '';
				window.location.href = "?filtro=" + filtroValue + "&selected=" + selectedValue;
			}
			/*]]>*/
		</script>

		<div th:insert="~{fragments/foot.html :: foot}"></div>
	</body>
</html>